<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SU2 Analysis Interface Module (AIM): SU2 AIM Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SU2 Analysis Interface Module (AIM)
   </div>
   <div id="projectbrief">SU2 Analysis Interface Module (AIM) based on FUN3D AIM</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SU2 AIM Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#su2aimprereq">Prerequisites</a><ul><li class="level2"><a href="#su2reqfiles">Script files</a></li>
</ul>
</li>
<li class="level1"><a href="#process">pyCAPS walkthrough using SU2</a><ul><li class="level2"><a href="#su2csm">Part 1: Creating Geometry using ESP</a></li>
<li class="level2"><a href="#su2PyCAPS">Part 2: Performing analysis using CAPS/pyCAPS</a></li>
</ul>
</li>
<li class="level1"><a href="#runsu2">Executing pyCAPS script</a></li>
</ul>
</div>
<div class="textblock"><p>This is a walkthrough for using SU2 AIM to analyze and three-dimensional two-wing configuration.</p>
<h1><a class="anchor" id="su2aimprereq"></a>
Prerequisites</h1>
<p>It is presumed that ESP and CAPS have been already installed. In addition, appropriate meshing and analysis packages were available for CAPS to link them to the corresponding AIMS.</p>
<p>In this example, TetGen is used for volume mesh generation, and SU2 is used for flow analysis. During the CAPS/pyCAPS build process, the location of TetGen source code needs to be set in ESPenv.sh to build TetGen AIM.</p>
<h2><a class="anchor" id="su2reqfiles"></a>
Script files</h2>
<p>Two scripts are used for this illustration:</p><ol type="1">
<li>cfdMultiBody.csm: Creates geometry, as described in [Part 1] of the next section</li>
<li>su2_and_Tetgen_PyTest.py: pyCAPS script for performing analysis, as described in the [Part 2] of the next section.</li>
</ol>
<h1><a class="anchor" id="process"></a>
pyCAPS walkthrough using SU2</h1>
<p>This is a two-part process. The first part consists of creating a geometry model. The second part is setting the AIMs that uses this geometry model to perform desired analysis. In this walkthrough, the geometry model is created using ESP script and setup for AIMs is done using pyCAPS.</p>
<h2><a class="anchor" id="su2csm"></a>
Part 1: Creating Geometry using ESP</h2>
<p>Step 1: The CSM script generates Bodies which are designed to be used by specific AIMs. The AIMs that the Body is designed for is communicated to the CAPS framework via the “capsAIM” string attribute. This is a semicolon-separated string with the list of AIM names. Thus, the CSM author can give a clear indication to which AIMs should use the Body. In this example, the list contains the list of mesh generators and CFD solvers that can consume the body: </p><div class="fragment"><div class="line">ATTRIBUTE capsAIM $fun3dAIM;su2AIM;egadsTessAIM;aflr4AIM;pointwiseAIM;tetgenAIM;aflr3AIM #CFD Analysis</div>
</div><!-- fragment --><p> Step 2: A typical geometry model can be created and interactively modified using design parameters. These design parameters are either design-variable based, or geometry-variables based. In this example a two-wing configuration is created using following design parameters, </p><div class="fragment"><div class="line">DESPMTR   area         40.00000</div>
<div class="line">DESPMTR   aspect       5.00000</div>
<div class="line">DESPMTR   taper        0.50000</div>
<div class="line">DESPMTR   twist        15.00000</div>
<div class="line">DESPMTR   lesweep      30.00000</div>
<div class="line">DESPMTR   dihedral     1.00000</div>
</div><!-- fragment --><p>as well as the following configuration design paramters. Configuration quantities cannot be used with sensitivities. </p><div class="fragment"><div class="line">CFGPMTR   series            8412</div>
<div class="line">CFGPMTR   series2           0020</div>
<div class="line">CFGPMTR   sharpte           0</div>
</div><!-- fragment --><p> Step 3: Set CAPS internal attributes </p><div class="fragment"><div class="line"># Set reference values</div>
<div class="line">ATTRIBUTE capsReferenceArea     area</div>
<div class="line">ATTRIBUTE capsReferenceChord    sqrt(area/aspect)</div>
<div class="line">ATTRIBUTE capsReferenceSpan     sqrt(area/aspect)*aspect</div>
</div><!-- fragment --><p> Step 4: Local analytical formulation for geometry creation </p><div class="fragment"><div class="line">SET       cmean     sqrt(area/aspect)</div>
<div class="line">SET       span      cmean*aspect</div>
<div class="line">SET       sspan     span/2</div>
<div class="line">SET       croot     2*cmean/(1+taper)</div>
<div class="line">SET       ctip      croot*taper</div>
<div class="line">SET       xtip      sspan*tand(lesweep)</div>
<div class="line">SET       ytip      sspan*tand(dihedral)</div>
<div class="line">SET       ybot      -0.1*croot</div>
<div class="line">SET       ytop      +0.2*croot+ytip</div>
<div class="line">SET       extend    0.02*cmean</div>
</div><!-- fragment --><p> Step 5: Building solid model. Once all design and locale variables are defined, a half span, solid model is created by "ruling" together to NACA series airfoils (following a series of scales, rotations, and translations). <br  />
 </p><div class="fragment"><div class="line">MARK</div>
<div class="line">   UDPRIM    naca   Series   series    sharpte sharpte</div>
<div class="line">      SCALE     croot </div>
<div class="line">   UDPRIM    naca   Series   series2   sharpte sharpte</div>
<div class="line">      SCALE     ctip</div>
<div class="line">      ROTATEZ   -twist   0   0</div>
<div class="line">      TRANSLATE xtip   ytip   -sspan</div>
<div class="line">RULE</div>
</div><!-- fragment --><p> A full span model is then created by mirroring and joining the half-span model. </p><div class="fragment"><div class="line"># Store half of wing and keep a copy on the stack</div>
<div class="line">STORE     HalfWing 0 1</div>
<div class="line"> </div>
<div class="line"># Restore and mirror the half wing</div>
<div class="line">RESTORE   HalfWing 0</div>
<div class="line">    MIRROR    0   0   1   0</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Combine halfs into a whole</div>
<div class="line">JOIN     0</div>
</div><!-- fragment --><p> Once the desired model obtained it needs to be rotated so that it is in the expected aero-coordinated system (y- out the right wing, x- in the flow direction, and +z- up). </p><div class="fragment"><div class="line"># Get body into a typical aero-system </div>
<div class="line">ROTATEX 90 0 0</div>
</div><!-- fragment --><p> Step 6: An attribute is then placed in the geometry so that the geometry components may be reference by the SU2 AIM </p><div class="fragment"><div class="line"># Store the wing </div>
<div class="line">STORE     Wing 0 0</div>
<div class="line"> </div>
<div class="line"># Wing 1 - Restore</div>
<div class="line">RESTORE   Wing 0</div>
<div class="line">    ATTRIBUTE capsGroup    $Wing1</div>
<div class="line">    ATTRIBUTE capsMesh     $Wing1</div>
<div class="line">    ATTRIBUTE _name        $Wing1</div>
<div class="line">    ATTRIBUTE AFLR4_Cmp_ID 1</div>
<div class="line">    ATTRIBUTE AFLR4_Edge_Refinement_Weight 1</div>
</div><!-- fragment --><p> Next a second wing is created and scaled using the store/restore operations. </p><div class="fragment"><div class="line"># Wing 2 -  Restore and scale, translate</div>
<div class="line">RESTORE   Wing 0</div>
<div class="line">    ATTRIBUTE capsGroup         $Wing2</div>
<div class="line">    ATTRIBUTE capsMesh          $Wing2</div>
<div class="line">    ATTRIBUTE _name             $Wing2</div>
<div class="line">    ATTRIBUTE AFLR4_Scale_Factor 10</div>
<div class="line">    ATTRIBUTE AFLR4_Cmp_ID       2</div>
<div class="line"> </div>
<div class="line">    SCALE     0.4</div>
<div class="line">    TRANSLATE 10   0   0</div>
</div><!-- fragment --><p> Step 7: For three-dimensional CFD analysis with the FUN3D AIM a "farfield" or "bounding box" boundary need to be also provided. In this example a simple sphere is created, and designated as such using the capsGroup attribute. </p><div class="fragment"><div class="line">SPHERE    0   0   0   80</div>
<div class="line">    ATTRIBUTE capsGroup   $Farfield</div>
<div class="line">    ATTRIBUTE capsMesh    $Farfield</div>
<div class="line">    ATTRIBUTE _name       $Farfield</div>
<div class="line">    ATTRIBUTE AFLR_GBC    $FARFIELD_UG3_GBC</div>
<div class="line">    ATTRIBUTE AFLR4_Cmp_ID 3</div>
<div class="line">    ATTRIBUTE capsMeshLength  cmean #Charachteristic length for meshing</div>
<div class="line">    ATTRIBUTE .tParam &quot;30.;5.;30;&quot;</div>
</div><!-- fragment --><p> Step 8: Close the ESP script </p><div class="fragment"><div class="line">END</div>
</div><!-- fragment --><h2><a class="anchor" id="su2PyCAPS"></a>
Part 2: Performing analysis using CAPS/pyCAPS</h2>
<p>Step 1: Import (py)CAPS environment. </p><div class="fragment"><div class="line"><span class="comment"># Import pyCAPS module</span></div>
<div class="line"><span class="keyword">import</span> pyCAPS</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Import os module</span></div>
<div class="line"><span class="keyword">import</span> os</div>
<div class="line"><span class="keyword">import</span> argparse</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Import SU2 Python interface module</span></div>
<div class="line"><span class="keyword">from</span> parallel_computation <span class="keyword">import</span> parallel_computation <span class="keyword">as</span> su2Run</div>
</div><!-- fragment --><p> Step 2: Load the geometry </p><div class="fragment"><div class="line">geometryScript = os.path.join(<span class="stringliteral">&quot;..&quot;</span>,<span class="stringliteral">&quot;csmData&quot;</span>,<span class="stringliteral">&quot;cfdMultiBody.csm&quot;</span>)</div>
<div class="line">myProblem = pyCAPS.Problem(problemName=workDir,</div>
<div class="line">                           capsFile=geometryScript,</div>
<div class="line">                           outLevel=args.outLevel)</div>
</div><!-- fragment --><p> Step 3: Make a list of design parameters available to interact with geometry model </p><div class="fragment"><div class="line"><span class="comment"># Change a design parameter - area in the geometry</span></div>
<div class="line">myProblem.geometry.despmtr.area = 50</div>
</div><!-- fragment --><p> Step 4: Load required AIMS. A typical high-fidelity CFD analysis requires mesh AIMs and an analysis AIM. For surface meshing, the face tessellation from ESP geometry can be directly used as a surface mesh. If the face tessellation is not satisfactory, an additional step of using surface AIM for external surface mesh generator will be required. Here, the face tessellation is used as surface mesh. For volume mesh generation, TetGen is used. For this, TetGen AIM is used. </p><div class="fragment"><div class="line"><span class="comment"># Load EGADS Tess aim</span></div>
<div class="line">mySurfMesh = myProblem.analysis.create(aim = <span class="stringliteral">&quot;egadsTessAIM&quot;</span>,</div>
<div class="line">                                       name = <span class="stringliteral">&quot;tess&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Load Tetgen aim</span></div>
<div class="line">myMesh = myProblem.analysis.create(aim = <span class="stringliteral">&quot;tetgenAIM&quot;</span>,</div>
<div class="line">                                   name = <span class="stringliteral">&quot;myMesh&quot;</span>)</div>
</div><!-- fragment --><p> Provide appropriate inputs to mesh generator required to generate mesh with adequate mesh quality and any additional features, such as boundary layer and local refinement. Refer TetGen AIM documentation for the list of all the available options. </p><div class="fragment"><div class="line"><span class="comment"># Set project name so a mesh file is generated</span></div>
<div class="line">mySurfMesh.input.Proj_Name = <span class="stringliteral">&quot;egadsTessMesh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set new EGADS body tessellation parameters</span></div>
<div class="line">mySurfMesh.input.Tess_Params = [0.5, 0.1, 20.0]</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set output grid format since a project name is being supplied - Tecplot file</span></div>
<div class="line">mySurfMesh.input.Mesh_Format = <span class="stringliteral">&quot;Tecplot&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Link surface mesh from EGADS to TetGen</span></div>
<div class="line">myMesh.input[<span class="stringliteral">&quot;Surface_Mesh&quot;</span>].link(mySurfMesh.output[<span class="stringliteral">&quot;Surface_Mesh&quot;</span>])</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Preserve surface mesh while meshing</span></div>
<div class="line">myMesh.input.Preserve_Surf_Mesh = <span class="keyword">True</span></div>
</div><!-- fragment --><p> Note that both EGADS and TetGen mesh generates are executed automaticall by CAPS: </p><div class="fragment"><div class="line"> </div>
</div><!-- fragment --><p> Load and SU2 AIM and link it to TetGen AIM as a parent. This step is required so that the volume mesh generated by TetGen AIM can be used for SU2 analysis. This step allows the volume mesh generated by TetGen AIM to be converted into SU2 native format. </p><div class="fragment"><div class="line"><span class="comment"># Load SU2 aim - child of Tetgen AIM</span></div>
<div class="line">myAnalysis = myProblem.analysis.create(aim = <span class="stringliteral">&quot;su2AIM&quot;</span>, name = <span class="stringliteral">&quot;su2&quot;</span>)</div>
</div><!-- fragment --><p> Set analysis parameters specific to SU2. These parameters are automatically converted into SU2 specific format and transferred into the SU2 configuration file. See <a class="el" href="aimInputsSU2.html">AIM Inputs</a> for the available options. </p><div class="fragment"><div class="line"><span class="comment"># Link the Mesh to the TetGen Volume_Mesh</span></div>
<div class="line">myAnalysis.input[<span class="stringliteral">&quot;Mesh&quot;</span>].link(myMesh.output[<span class="stringliteral">&quot;Volume_Mesh&quot;</span>])</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set SU2 Version</span></div>
<div class="line">myAnalysis.input.SU2_Version = <span class="stringliteral">&quot;Blackbird&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set project name</span></div>
<div class="line">myAnalysis.input.Proj_Name = <span class="stringliteral">&quot;pyCAPS_SU2_Tetgen&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set AoA number</span></div>
<div class="line">myAnalysis.input.Alpha = 1.0</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set Mach number</span></div>
<div class="line">myAnalysis.input.Mach = 0.5901</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set equation type</span></div>
<div class="line">myAnalysis.input.Equation_Type = <span class="stringliteral">&quot;Compressible&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set number of iterations</span></div>
<div class="line">myAnalysis.input.Num_Iter = 5</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Specifcy the boundares used to compute forces</span></div>
<div class="line">myAnalysis.input.Surface_Monitor = [<span class="stringliteral">&quot;Wing1&quot;</span>, <span class="stringliteral">&quot;Wing2&quot;</span>]</div>
</div><!-- fragment --><p> Set the boundary conditions using attribution. These boundary tags and associated boundary conditions are converted into SU2 specific boundary conditions and set in the SU2 configuration file. </p><div class="fragment"><div class="line"><span class="comment"># Set boundary conditions</span></div>
<div class="line">inviscidBC1 = {<span class="stringliteral">&quot;bcType&quot;</span> : <span class="stringliteral">&quot;Inviscid&quot;</span>}</div>
<div class="line">inviscidBC2 = {<span class="stringliteral">&quot;bcType&quot;</span> : <span class="stringliteral">&quot;Inviscid&quot;</span>}</div>
<div class="line">myAnalysis.input.Boundary_Condition = {<span class="stringliteral">&quot;Wing1&quot;</span>   : inviscidBC1,</div>
<div class="line">                                       <span class="stringliteral">&quot;Wing2&quot;</span>   : inviscidBC2,</div>
<div class="line">                                       <span class="stringliteral">&quot;Farfield&quot;</span>: <span class="stringliteral">&quot;farfield&quot;</span>}</div>
</div><!-- fragment --><p> After all desired options are set aimPreAnalysis needs to be executed. </p><div class="fragment"><div class="line">myAnalysis.preAnalysis()</div>
</div><!-- fragment --><p> Execute SU2 flow solver. Here the python module for parallel computation is used. The configuration file (and the corresponding mesh file) is provided automatically for executing SU2. The number of processors can be set by user, depending on the available computational resources. </p><div class="fragment"><div class="line"><span class="keywordflow">print</span> (<span class="stringliteral">&quot;\n\nRunning SU2......&quot;</span>)</div>
<div class="line">currentDirectory = os.getcwd() <span class="comment"># Get our current working directory</span></div>
<div class="line"> </div>
<div class="line">os.chdir(myAnalysis.analysisDir) <span class="comment"># Move into test directory</span></div>
<div class="line"> </div>
<div class="line">su2Run(myAnalysis.input.Proj_Name + <span class="stringliteral">&quot;.cfg&quot;</span>, args.numberProc) <span class="comment"># Run SU2</span></div>
<div class="line"> </div>
<div class="line">os.chdir(currentDirectory) <span class="comment"># Move back to top directory</span></div>
</div><!-- fragment --><p> Perform post analysis task, such as parsing the final values from SU2 execution. </p><div class="fragment"><div class="line">myAnalysis.postAnalysis()</div>
</div><!-- fragment --><p> Step 5: Print the post analysis values. </p><div class="fragment"><div class="line"><span class="comment"># Get force results</span></div>
<div class="line">print(<span class="stringliteral">&quot;Total Force - Pressure + Viscous&quot;</span>)</div>
<div class="line"><span class="comment"># Get Lift and Drag coefficients</span></div>
<div class="line">print(<span class="stringliteral">&quot;Cl = &quot;</span> , myAnalysis.output.CLtot,</div>
<div class="line">      <span class="stringliteral">&quot;Cd = &quot;</span> , myAnalysis.output.CDtot)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Get Cmx, Cmy, and Cmz coefficients</span></div>
<div class="line">print(<span class="stringliteral">&quot;Cmx = &quot;</span> , myAnalysis.output.CMXtot,</div>
<div class="line">      <span class="stringliteral">&quot;Cmy = &quot;</span> , myAnalysis.output.CMYtot,</div>
<div class="line">      <span class="stringliteral">&quot;Cmz = &quot;</span> , myAnalysis.output.CMZtot)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Get Cx, Cy, Cz coefficients</span></div>
<div class="line">print(<span class="stringliteral">&quot;Cx = &quot;</span> , myAnalysis.output.CXtot,</div>
<div class="line">      <span class="stringliteral">&quot;Cy = &quot;</span> , myAnalysis.output.CYtot,</div>
<div class="line">      <span class="stringliteral">&quot;Cz = &quot;</span> , myAnalysis.output.CZtot)</div>
</div><!-- fragment --> <h1><a class="anchor" id="runsu2"></a>
Executing pyCAPS script</h1>
<p>Issuing the following command executes the script: </p><pre class="fragment">python su2_and_Tetgen_PyTest.py
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jul 2 2022 10:12:56 for SU2 Analysis Interface Module (AIM) by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
